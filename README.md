# Easy Chat - ç®€æ˜“èŠå¤©å®¤

ä¸€ä¸ªåŸºäº Deno çš„æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰å®æ—¶èŠå¤©å®¤åº”ç”¨ã€‚

## ğŸŒŸ åŠŸèƒ½ç‰¹ç‚¹

- âœ¨ **å®æ—¶æ¶ˆæ¯ä¼ é€’** - åŸºäº WebSocket çš„å³æ—¶é€šä¿¡
- ğŸ‘¥ **åœ¨çº¿ç”¨æˆ·æ˜¾ç¤º** - å®æ—¶æ˜¾ç¤ºå½“å‰åœ¨çº¿ç”¨æˆ·åˆ—è¡¨
- ğŸš€ **æ— éœ€æ³¨å†Œ** - è¾“å…¥ç”¨æˆ·åå³å¯å¼€å§‹èŠå¤©
- ğŸ“± **ç§»åŠ¨ç«¯ä¼˜åŒ–** - å®Œç¾æ”¯æŒæ‰‹æœºå’Œå¹³æ¿è®¾å¤‡
- ğŸ”’ **å®‰å…¨é˜²æŠ¤** - HTML è½¬ä¹‰é˜²æ­¢ XSS æ”»å‡»
- ğŸ’¾ **å†…å­˜å­˜å‚¨** - æ‰€æœ‰æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œæ— éœ€æ•°æ®åº“
- ğŸ¨ **ç°ä»£ç•Œé¢** - ç¾è§‚çš„æ¸å˜è‰²è®¾è®¡
- ğŸŒ™ **æ·±è‰²æ¨¡å¼** - è‡ªåŠ¨é€‚é…ç³»ç»Ÿä¸»é¢˜
- ğŸ“² **PWA æ”¯æŒ** - å¯å®‰è£…åˆ°æ‰‹æœºä¸»å±å¹•
- â™¿ **æ— éšœç¢è®¿é—®** - æ”¯æŒå±å¹•é˜…è¯»å™¨å’Œé”®ç›˜å¯¼èˆª

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- **è¿è¡Œæ—¶**: Deno 2.0+
- **åç«¯**: Deno å†…ç½® HTTP æœåŠ¡å™¨
- **WebSocket**: Deno å†…ç½® WebSocket æ”¯æŒ
- **æ¨¡æ¿å¼•æ“**: è‡ªå®šä¹‰ SSR æ¨¡æ¿ç³»ç»Ÿ
- **å‰ç«¯**: åŸç”Ÿ HTML/CSS/JavaScript
- **æµ‹è¯•**: Deno å†…ç½®æµ‹è¯•æ¡†æ¶

## ğŸ“ é¡¹ç›®ç»“æ„

```
easy-chat/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.ts              # åº”ç”¨å…¥å£ç‚¹
â”‚   â”œâ”€â”€ router.ts            # HTTP è·¯ç”±å¤„ç†
â”‚   â”œâ”€â”€ websocket.ts         # WebSocket è¿æ¥å¤„ç†
â”‚   â”œâ”€â”€ chat-room.ts         # èŠå¤©å®¤æ ¸å¿ƒé€»è¾‘
â”‚   â”œâ”€â”€ template.ts          # SSR æ¨¡æ¿å¼•æ“
â”‚   â””â”€â”€ types.ts             # TypeScript ç±»å‹å®šä¹‰
â”œâ”€â”€ templates/
â”‚   â”œâ”€â”€ home.html            # é¦–é¡µæ¨¡æ¿
â”‚   â””â”€â”€ chat.html            # èŠå¤©å®¤æ¨¡æ¿
â”œâ”€â”€ static/
â”‚   â””â”€â”€ css/
â”‚       â””â”€â”€ style.css        # æ ·å¼æ–‡ä»¶
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ chat-room.test.ts    # èŠå¤©å®¤å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ template.test.ts     # æ¨¡æ¿å¼•æ“æµ‹è¯•
â”‚   â””â”€â”€ integration.test.ts  # é›†æˆæµ‹è¯•
â”œâ”€â”€ deno.json                # Deno é…ç½®æ–‡ä»¶
â””â”€â”€ README.md                # é¡¹ç›®æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- [Deno](https://deno.land/) 2.0 æˆ–æ›´é«˜ç‰ˆæœ¬

### å®‰è£…å’Œè¿è¡Œ

1. **å…‹éš†é¡¹ç›®**
   ```bash
   git clone <repository-url>
   cd easy-chat
   ```

2. **å¯åŠ¨å¼€å‘æœåŠ¡å™¨**
   ```bash
   deno task dev
   ```
   æˆ–è€…
   ```bash
   deno run --allow-net --allow-read --allow-env --watch src/main.ts
   ```

3. **è®¿é—®åº”ç”¨**
   æ‰“å¼€æµè§ˆå™¨è®¿é—® [http://localhost:8000](http://localhost:8000)

### ç”Ÿäº§ç¯å¢ƒè¿è¡Œ

```bash
deno task start
```

æˆ–è€…

```bash
deno run --allow-net --allow-read --allow-env src/main.ts
```

### è‡ªå®šä¹‰ç«¯å£

```bash
PORT=3000 deno task start
```

## ğŸŒ é€šè¿‡ Cloudflare Tunnel éƒ¨ç½²

Easy Chat æ”¯æŒé€šè¿‡ Cloudflare Tunnel è¿›è¡Œéƒ¨ç½²ï¼Œå®ç°å®‰å…¨çš„å…¬ç½‘è®¿é—®ã€‚

### å¿«é€Ÿéƒ¨ç½²

1. **å®‰è£… cloudflared**
   ```bash
   # macOS
   brew install cloudflare/cloudflare/cloudflared

   # Linux
   wget -q https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64.deb
   sudo dpkg -i cloudflared-linux-amd64.deb
   ```

2. **åˆ›å»ºéš§é“**
   ```bash
   cloudflared tunnel login
   cloudflared tunnel create easy-chat
   cloudflared tunnel route dns easy-chat your-domain.com
   ```

3. **å¯åŠ¨æœåŠ¡**
   ```bash
   # å¯åŠ¨ Easy Chat
   deno task start

   # åœ¨å¦ä¸€ä¸ªç»ˆç«¯å¯åŠ¨éš§é“
   cloudflared tunnel --url http://localhost:8000 run easy-chat
   ```

### WebSocket æ”¯æŒ

Easy Chat å·²ç»å†…ç½®äº†å¯¹ Cloudflare Tunnel çš„ WebSocket æ”¯æŒï¼š

- âœ… è‡ªåŠ¨åè®®æ£€æµ‹ï¼ˆHTTP/HTTPS â†’ WS/WSSï¼‰
- âœ… æ™ºèƒ½é‡è¿æœºåˆ¶
- âœ… è¿æ¥çŠ¶æ€ç›‘æ§
- âœ… é”™è¯¯å¤„ç†å’Œç”¨æˆ·æç¤º

è¯¦ç»†é…ç½®è¯·å‚è€ƒ [Cloudflare éƒ¨ç½²æŒ‡å—](CLOUDFLARE_SETUP.md)ã€‚

## ğŸ§ª æµ‹è¯•

### è¿è¡Œæ‰€æœ‰æµ‹è¯•

```bash
deno task test
```

### è¿è¡Œå•å…ƒæµ‹è¯•

```bash
deno test --allow-net --allow-read tests/chat-room.test.ts tests/template.test.ts
```

### è¿è¡Œé›†æˆæµ‹è¯•

```bash
deno test --allow-net --allow-read --allow-run --allow-env tests/integration.test.ts
```

### ç›‘å¬æ¨¡å¼æµ‹è¯•

```bash
deno task test:watch
```

## ğŸ“– ä½¿ç”¨è¯´æ˜

### åŸºæœ¬ä½¿ç”¨

1. è®¿é—®é¦–é¡µ `http://localhost:8000`
2. è¾“å…¥ç”¨æˆ·åï¼ˆæ”¯æŒä¸­æ–‡ã€è‹±æ–‡ã€æ•°å­—ã€ä¸‹åˆ’çº¿å’Œè¿å­—ç¬¦ï¼‰
3. ç‚¹å‡»"è¿›å…¥èŠå¤©å®¤"
4. å¼€å§‹èŠå¤©ï¼

### åŠŸèƒ½è¯´æ˜

- **ç”¨æˆ·åè§„åˆ™**: 1-20ä¸ªå­—ç¬¦ï¼Œæ”¯æŒä¸­æ–‡ã€è‹±æ–‡ã€æ•°å­—ã€ä¸‹åˆ’çº¿å’Œè¿å­—ç¬¦
- **æ¶ˆæ¯é•¿åº¦**: æœ€å¤š500ä¸ªå­—ç¬¦
- **å†å²æ¶ˆæ¯**: ç³»ç»Ÿä¿ç•™æœ€è¿‘100æ¡æ¶ˆæ¯
- **åœ¨çº¿ç”¨æˆ·**: å®æ—¶æ˜¾ç¤ºå½“å‰åœ¨çº¿ç”¨æˆ·åˆ—è¡¨
- **è‡ªåŠ¨é‡è¿**: WebSocket è¿æ¥æ–­å¼€æ—¶ä¼šæ˜¾ç¤ºæç¤º

### ç§»åŠ¨ç«¯ç‰¹æ€§

- **å“åº”å¼å¸ƒå±€**: è‡ªåŠ¨é€‚é…ä¸åŒå±å¹•å°ºå¯¸
- **è§¦æ‘¸ä¼˜åŒ–**: ä¼˜åŒ–çš„è§¦æ‘¸äº¤äº’å’Œæ‰‹åŠ¿æ”¯æŒ
- **é”®ç›˜é€‚é…**: æ™ºèƒ½å¤„ç†è™šæ‹Ÿé”®ç›˜å¼¹å‡ºå’Œæ”¶èµ·
- **PWA æ”¯æŒ**: å¯æ·»åŠ åˆ°ä¸»å±å¹•ï¼Œç¦»çº¿æç¤º
- **æ¨ªç«–å±é€‚é…**: æ”¯æŒè®¾å¤‡æ—‹è½¬æ—¶çš„å¸ƒå±€è°ƒæ•´
- **æ·±è‰²æ¨¡å¼**: è‡ªåŠ¨æ£€æµ‹ç³»ç»Ÿä¸»é¢˜åå¥½
- **æ€§èƒ½ä¼˜åŒ–**: é’ˆå¯¹ç§»åŠ¨è®¾å¤‡çš„æ»šåŠ¨å’Œæ¸²æŸ“ä¼˜åŒ–
- **æ— éšœç¢æ”¯æŒ**: æ”¯æŒå±å¹•é˜…è¯»å™¨å’Œè¾…åŠ©åŠŸèƒ½

### API ç«¯ç‚¹

- `GET /` - é¦–é¡µ
- `GET /chat?username=<ç”¨æˆ·å>` - èŠå¤©å®¤é¡µé¢
- `GET /static/*` - é™æ€æ–‡ä»¶æœåŠ¡
- `WebSocket /ws?username=<ç”¨æˆ·å>` - WebSocket è¿æ¥

## ğŸ”§ å¼€å‘

### æ·»åŠ æ–°åŠŸèƒ½

1. åœ¨ `src/` ç›®å½•ä¸‹æ·»åŠ æ–°çš„æ¨¡å—
2. æ›´æ–° `src/types.ts` ä¸­çš„ç±»å‹å®šä¹‰
3. åœ¨ `tests/` ç›®å½•ä¸‹æ·»åŠ ç›¸åº”çš„æµ‹è¯•
4. æ›´æ–°æ–‡æ¡£

### ä»£ç è§„èŒƒ

- ä½¿ç”¨ TypeScript ä¸¥æ ¼æ¨¡å¼
- éµå¾ª Deno æœ€ä½³å®è·µ
- ä¸ºæ‰€æœ‰å…¬å…±å‡½æ•°æ·»åŠ  JSDoc æ³¨é‡Š
- ä¿æŒæµ‹è¯•è¦†ç›–ç‡

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç«¯å£è¢«å ç”¨**
   ```bash
   Error: Address already in use
   ```
   è§£å†³æ–¹æ¡ˆï¼šæ›´æ”¹ç«¯å£æˆ–åœæ­¢å ç”¨ç«¯å£çš„è¿›ç¨‹
   ```bash
   PORT=3000 deno task start
   ```

2. **WebSocket è¿æ¥å¤±è´¥**
   - æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
   - ç¡®ä¿æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ
   - æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯

3. **ç”¨æˆ·åé‡å¤**
   - ç³»ç»Ÿä¼šè‡ªåŠ¨æ‹’ç»é‡å¤çš„ç”¨æˆ·å
   - å°è¯•ä½¿ç”¨ä¸åŒçš„ç”¨æˆ·å

### è°ƒè¯•

å¯ç”¨è¯¦ç»†æ—¥å¿—ï¼š
```bash
DENO_LOG=debug deno task start
```

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æ‰“å¼€ Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ™ è‡´è°¢

- [Deno](https://deno.land/) - ç°ä»£çš„ JavaScript/TypeScript è¿è¡Œæ—¶
- [Deno Standard Library](https://deno.land/std) - é«˜è´¨é‡çš„æ ‡å‡†åº“

---

**Happy Chatting! ğŸ‰**
